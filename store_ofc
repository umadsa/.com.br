<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMADSA Store | Loja Ministerial</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700;900&family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        serif: ['Roboto Slab', 'serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for Cart */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #18181b; } /* zinc-900 */
        ::-webkit-scrollbar-thumb { background: #f59e0b; border-radius: 10px; } /* amber-500 */
        ::-webkit-scrollbar-thumb:hover { background: #d97706; }
    </style>
</head>
<body class="bg-zinc-950 min-h-screen font-sans text-zinc-200">

    <header id="main-header" class="sticky top-0 z-40 bg-black shadow-md border-b border-amber-500/30">
        <div class="container mx-auto px-6 py-4 flex items-center justify-between">
            <div class="flex items-center gap-3 cursor-pointer" onclick="changeView('home')">
                <div class="w-10 h-10 border-2 border-amber-500 rounded flex items-center justify-center text-amber-500 font-bold text-xl">U</div>
                <div>
                    <h1 class="text-xl font-bold text-white leading-tight">UMADSA <span class="text-amber-500">STORE</span></h1>
                </div>
            </div>

            <div class="hidden md:flex flex-1 max-w-xl mx-8 relative">
                <input 
                    type="text" 
                    id="searchInput"
                    placeholder="Buscar produtos..." 
                    class="w-full border border-zinc-700 bg-zinc-900 text-white rounded py-2 px-4 focus:outline-none focus:border-amber-500 text-sm"
                    oninput="handleSearch()"
                >
                <i class="fa-solid fa-magnifying-glass absolute right-3 top-3 text-zinc-400"></i>
            </div>

            <div class="flex items-center gap-6">
                <div id="auth-area">
                    <button onclick="requireAuth()" class="text-zinc-300 hover:text-amber-500 text-sm font-bold uppercase tracking-wider flex items-center gap-2">
                        <i class="fa-solid fa-lock"></i> Login
                    </button>
                </div>
                
                <button class="relative text-amber-500 hover:text-amber-400" onclick="requireAuth(openCart)">
                    <i class="fa-solid fa-cart-shopping text-2xl"></i>
                    <span id="cart-badge" class="hidden absolute -top-2 -right-2 bg-white text-black text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center">0</span>
                </button>
            </div>
        </div>
        
        <div class="bg-zinc-950 border-t border-zinc-800 hidden md:block">
            <div class="container mx-auto px-6 py-3 flex justify-center gap-8" id="category-container">
                </div>
        </div>
    </header>

    <main id="view-home" class="container mx-auto px-6 py-12 block">
        <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            </div>
    </main>

    <div id="view-checkout" class="bg-black min-h-screen text-white pb-12 hidden">
        <div class="container mx-auto px-4 py-8 max-w-5xl">
            <button onclick="changeView('home')" class="flex items-center text-amber-500 mb-8 uppercase text-sm font-bold hover:underline">
                <i class="fa-solid fa-arrow-left mr-2"></i> Voltar
            </button>

            <h2 class="text-3xl font-serif font-bold mb-8">Finalizar Pedido</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                <div class="space-y-6">
                    <div class="bg-zinc-900 p-6 rounded border border-zinc-800">
                        <h3 class="font-bold text-amber-500 mb-4 flex items-center gap-2"><i class="fa-solid fa-circle-check"></i> Dados Confirmados</h3>
                        <p class="text-sm text-zinc-400">Enviaremos a atualização do pedido para o seu e-mail cadastrado.</p>
                        <div class="mt-4 text-sm space-y-1 bg-black p-4 rounded border border-zinc-800" id="checkout-user-data">
                            </div>
                    </div>

                    <div class="bg-zinc-900 p-6 rounded border border-amber-500 shadow-[0_0_15px_rgba(212,175,55,0.1)]">
                        <h3 class="font-bold text-white mb-4 flex items-center gap-2"><i class="fa-solid fa-credit-card"></i> Pagamento Seguro via Cora</h3>
                        <p class="text-sm text-zinc-400 mb-6">
                            Nossa loja utiliza o banco <strong>Cora</strong> para pagamentos e gestão financeira do caixa do ministério. Ao confirmar, o Pix Copia e Cola será gerado automaticamente.
                        </p>
                        <div class="space-y-3">
                            <label class="flex items-center gap-4 p-4 border border-amber-500 bg-amber-500/10 rounded cursor-pointer">
                                <input type="radio" name="payment" checked class="accent-amber-500" />
                                <span class="font-bold text-white">Pix (Aprovação Imediata)</span>
                            </label>
                            <label class="flex items-center gap-4 p-4 border border-zinc-800 rounded opacity-50 cursor-not-allowed">
                                <input type="radio" name="payment" disabled />
                                <span class="font-bold text-zinc-500">Boleto Cora (Em breve)</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="bg-zinc-900 p-8 rounded border border-zinc-800 h-fit sticky top-24">
                    <h3 class="text-xl font-bold mb-6 border-b border-zinc-800 pb-4">Resumo do Pedido</h3>
                    <div id="checkout-items" class="space-y-4 mb-6">
                        </div>
                    <div class="border-t border-zinc-800 pt-6">
                        <div class="flex justify-between text-2xl font-black text-white">
                            <span>TOTAL:</span>
                            <span id="checkout-total" class="text-amber-500">R$ 0,00</span>
                        </div>
                        <button onclick="finishOrder()" class="w-full bg-amber-500 text-black font-bold py-4 rounded mt-8 hover:bg-amber-600 transition uppercase tracking-widest">
                            Gerar Pix Cora
                        </button>
                        <p class="text-xs text-center text-zinc-500 mt-4">*Produtos encomendados: Prazo de 15 dias para fabricação e entrega via liderança.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="view-success" class="min-h-screen bg-black flex flex-col items-center justify-center text-center p-4 hidden">
        <i class="fa-solid fa-circle-check text-6xl text-amber-500 mb-6"></i>
        <h1 class="text-4xl font-serif font-bold text-white mb-2">Pedido Gerado!</h1>
        <p class="text-zinc-400 mb-8">Abra o app do seu banco e pague o Pix Copia e Cola gerado pela Cora.</p>
        <div class="bg-zinc-900 p-4 border border-zinc-800 rounded mb-8 max-w-md w-full break-all font-mono text-xs text-amber-500">
            00020101021126580014br.gov.bcb.pix0136UMADSA-CORA-API-MOCK-PIX-CODE-789
        </div>
        <button onclick="changeView('home')" class="bg-amber-500 text-black font-bold px-8 py-3 rounded uppercase hover:bg-amber-600">Voltar para Loja</button>
    </div>

    <div id="modal-login" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex justify-center items-center p-4 hidden">
        <div class="bg-zinc-900 border border-amber-500 p-8 rounded-lg w-full max-w-md relative shadow-2xl shadow-amber-500/20">
            <button onclick="closeModal('modal-login')" class="absolute top-4 right-4 text-zinc-400 hover:text-amber-500"><i class="fa-solid fa-xmark text-xl"></i></button>
            <div class="text-center mb-6">
                <div class="w-12 h-12 border-2 border-amber-500 rounded flex items-center justify-center text-amber-500 text-xl font-bold mx-auto mb-4">U</div>
                <h2 class="text-2xl font-serif font-bold text-white">Acesso Restrito</h2>
                <p class="text-zinc-400 text-sm mt-2">Faça login com sua conta UMADSA para visualizar preços e comprar.</p>
            </div>
            <form onsubmit="handleLogin(event)" class="space-y-4">
                <div>
                    <label class="block text-xs text-amber-500 uppercase tracking-widest mb-1">E-mail</label>
                    <input required type="email" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                </div>
                <div>
                    <label class="block text-xs text-amber-500 uppercase tracking-widest mb-1">Senha</label>
                    <input required type="password" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                </div>
                <button type="submit" class="w-full bg-amber-500 text-black font-bold py-3 rounded hover:bg-amber-600 transition mt-4">Entrar e Comprar</button>
            </form>
        </div>
    </div>

    <div id="modal-profile" class="fixed inset-0 bg-black/90 backdrop-blur-sm z-[100] flex justify-center items-center p-4 hidden">
        <div class="bg-zinc-900 border border-amber-500 p-8 rounded-lg w-full max-w-md relative">
            <div class="text-center mb-6">
                <i class="fa-solid fa-circle-exclamation text-3xl text-amber-500 mb-2"></i>
                <h2 class="text-2xl font-serif font-bold text-white">Complete seu Cadastro</h2>
                <p class="text-zinc-400 text-sm mt-2">Para realizar pedidos, precisamos dos seus dados de entrega completos.</p>
            </div>
            <form onsubmit="handleCompleteProfile(event)" class="space-y-4">
                <input required type="text" placeholder="Nome Completo" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                <div class="grid grid-cols-2 gap-4">
                    <input required type="text" placeholder="CPF" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                    <input required type="tel" placeholder="Celular (WhatsApp)" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                </div>
                <input required type="text" placeholder="CEP" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                <input required type="text" placeholder="Endereço Completo com Número" class="w-full p-3 bg-black border border-zinc-700 rounded text-white focus:border-amber-500 focus:outline-none" />
                <button type="submit" class="w-full bg-amber-500 text-black font-bold py-3 rounded hover:bg-amber-600 transition mt-4">Salvar Dados</button>
            </form>
        </div>
    </div>

    <div id="cart-sidebar-overlay" class="fixed inset-0 z-50 flex justify-end hidden">
        <div class="absolute inset-0 bg-black/80" onclick="closeCart()"></div>
        <div class="relative w-full max-w-md bg-zinc-900 border-l border-amber-500 h-full flex flex-col shadow-2xl transform transition-transform translate-x-full" id="cart-sidebar-content" style="transition: transform 0.3s ease-out;">
            <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white uppercase tracking-widest"><i class="fa-solid fa-cart-shopping mr-2 text-amber-500"></i> Sua Sacola</h2>
                <button onclick="closeCart()" class="text-zinc-500 hover:text-amber-500"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            
            <div id="cart-items" class="flex-1 overflow-y-auto p-6 space-y-6">
                </div>
            
            <div id="cart-footer" class="p-6 bg-black border-t border-zinc-800 hidden">
                <div class="flex justify-between font-bold text-xl text-white mb-6">
                    <span>TOTAL:</span>
                    <span id="cart-total" class="text-amber-500">R$ 0,00</span>
                </div>
                <button onclick="goToCheckout()" class="w-full bg-amber-500 text-black font-bold py-4 rounded hover:bg-amber-600 transition tracking-wider">
                    IR PARA PAGAMENTO
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- MOCK DATA ---
        const PRODUCTS = [
            { id: 1, name: 'Camiseta Oficial Liderança "Chamados"', price: 89.90, category: 'Vestuário', image: 'https://images.unsplash.com/photo-1583743814966-8936f5b7be1a?auto=format&fit=crop&q=80&w=800' },
            { id: 2, name: 'Pin de Lapela Dourado UMADSA', price: 45.00, category: 'Acessórios', image: 'https://images.unsplash.com/photo-1611591437281-460bfbe1220a?auto=format&fit=crop&q=80&w=800' },
            { id: 3, name: 'Agenda Ministerial 2026 (Couro)', price: 119.90, category: 'Papelaria', image: 'https://images.unsplash.com/photo-1544816155-12df9643f363?auto=format&fit=crop&q=80&w=800' },
            { id: 4, name: 'Garrafa Térmica "Capelania"', price: 149.90, category: 'Utilidades', image: 'https://images.unsplash.com/photo-1602143407151-011141959309?auto=format&fit=crop&q=80&w=800' }
        ];
        const CATEGORIES = ['Todos', 'Vestuário', 'Utilidades', 'Acessórios', 'Papelaria'];

        // --- STATE ---
        let auth = { isAuthenticated: false, user: null, isProfileComplete: false };
        let cart = [];
        let activeCategory = 'Todos';
        let pendingAction = null; // Guarda a ação para executar após o login

        // --- UTILS ---
        const formatCurrency = (value) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(value);

        // --- INITIALIZE ---
        window.onload = () => {
            renderCategories();
            renderProducts();
        };

        // --- AUTH & BLOQUEIOS ---
        function requireAuth(actionCallback = null) {
            if (!auth.isAuthenticated) {
                pendingAction = actionCallback;
                document.getElementById('modal-login').classList.remove('hidden');
            } else if (!auth.isProfileComplete) {
                pendingAction = actionCallback;
                document.getElementById('modal-profile').classList.remove('hidden');
            } else {
                if(actionCallback) actionCallback();
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            auth = { isAuthenticated: true, user: { name: 'Líder UMADSA', email: 'lider@umadsa.com.br' }, isProfileComplete: false };
            closeModal('modal-login');
            updateAuthUI();
            
            // Exige completar cadastro logo após
            document.getElementById('modal-profile').classList.remove('hidden');
        }

        function handleCompleteProfile(e) {
            e.preventDefault();
            auth.isProfileComplete = true;
            closeModal('modal-profile');
            alert('Cadastro completo com sucesso! Boas compras.');
            
            if(pendingAction) {
                pendingAction();
                pendingAction = null;
            } else {
                renderProducts(); // Atualiza precos
            }
        }

        function updateAuthUI() {
            const authArea = document.getElementById('auth-area');
            if(auth.isAuthenticated) {
                authArea.innerHTML = `<div class="text-amber-500 text-sm font-bold flex items-center gap-2"><i class="fa-solid fa-user"></i> ${auth.user.name}</div>`;
            }
            renderProducts(); // Re-renderiza para mostrar os preços
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        // --- RENDERIZAR INTERFACE ---
        function renderCategories() {
            const container = document.getElementById('category-container');
            container.innerHTML = CATEGORIES.map(cat => `
                <button onclick="setCategory('${cat}')" 
                    class="text-sm font-bold uppercase tracking-widest hover:text-amber-500 transition-colors ${activeCategory === cat ? 'text-amber-500' : 'text-zinc-500'}">
                    ${cat}
                </button>
            `).join('');
        }

        function setCategory(cat) {
            activeCategory = cat;
            renderCategories();
            renderProducts();
        }

        function handleSearch() {
            renderProducts();
        }

        function renderProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('products-grid');
            
            const filtered = PRODUCTS.filter(p => 
                (activeCategory === 'Todos' || p.category === activeCategory) &&
                p.name.toLowerCase().includes(searchTerm)
            );

            if(filtered.length === 0) {
                container.innerHTML = `<div class="col-span-full text-center py-20"><p class="text-zinc-500">Nenhum produto encontrado.</p></div>`;
                return;
            }

            container.innerHTML = filtered.map(p => `
                <div class="group bg-zinc-900 rounded border border-zinc-800 hover:border-amber-500 transition-all duration-300 flex flex-col h-full overflow-hidden">
                    <div class="relative pt-[100%] bg-black">
                        <img src="${p.image}" class="absolute inset-0 w-full h-full object-cover opacity-80 group-hover:opacity-100 transition-opacity" />
                    </div>
                    <div class="p-5 flex flex-col flex-grow">
                        <p class="text-xs text-amber-500 mb-1 uppercase font-bold">${p.category}</p>
                        <h3 class="font-bold text-white mb-2 text-lg leading-tight">${p.name}</h3>
                        
                        <div class="mt-auto pt-4 flex items-center justify-between">
                            <div>
                                ${auth.isAuthenticated 
                                    ? `<p class="text-xl font-black text-white">${formatCurrency(p.price)}</p>` 
                                    : `<p class="text-sm font-bold text-zinc-500 flex items-center gap-1 cursor-pointer hover:text-amber-500" onclick="requireAuth()"><i class="fa-solid fa-lock text-xs"></i> Faça login para ver</p>`
                                }
                            </div>
                            <button onclick="addToCart(${p.id})" class="bg-zinc-800 text-amber-500 p-2 rounded hover:bg-amber-500 hover:text-black transition">
                                <i class="fa-solid fa-cart-shopping"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // --- CARRINHO ---
        function addToCart(productId) {
            requireAuth(() => {
                const product = PRODUCTS.find(p => p.id === productId);
                const existing = cart.find(item => item.id === productId);
                
                if (existing) {
                    existing.quantity += 1;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                
                updateCartUI();
                openCart();
            });
        }

        function updateCartUI() {
            const badge = document.getElementById('cart-badge');
            const totalQty = cart.reduce((acc, item) => acc + item.quantity, 0);
            
            if(totalQty > 0) {
                badge.innerText = totalQty;
                badge.classList.remove('hidden');
            } else {
                badge.classList.add('hidden');
            }

            const container = document.getElementById('cart-items');
            const footer = document.getElementById('cart-footer');
            
            if(cart.length === 0) {
                container.innerHTML = '<p class="text-zinc-500 text-center py-10">Sua sacola está vazia.</p>';
                footer.classList.add('hidden');
                return;
            }

            let total = 0;
            container.innerHTML = cart.map(item => {
                total += item.price * item.quantity;
                return `
                <div class="flex gap-4 border-b border-zinc-800 pb-4">
                    <img src="${item.image}" class="w-16 h-16 object-cover border border-zinc-700 rounded" />
                    <div class="flex-1">
                        <h3 class="text-sm font-bold text-white">${item.name}</h3>
                        <p class="text-xs text-zinc-500">Qtd: ${item.quantity}</p>
                        <p class="text-amber-500 font-bold mt-1">${formatCurrency(item.price)}</p>
                    </div>
                </div>
                `;
            }).join('');

            document.getElementById('cart-total').innerText = formatCurrency(total);
            footer.classList.remove('hidden');
        }

        function openCart() {
            const overlay = document.getElementById('cart-sidebar-overlay');
            const content = document.getElementById('cart-sidebar-content');
            overlay.classList.remove('hidden');
            setTimeout(() => { content.classList.remove('translate-x-full'); }, 10);
        }

        function closeCart() {
            const content = document.getElementById('cart-sidebar-content');
            content.classList.add('translate-x-full');
            setTimeout(() => { document.getElementById('cart-sidebar-overlay').classList.add('hidden'); }, 300);
        }

        // --- NAVEGAÇÃO DE VIEWS ---
        function changeView(viewName) {
            document.getElementById('view-home').classList.add('hidden');
            document.getElementById('view-checkout').classList.add('hidden');
            document.getElementById('view-success').classList.add('hidden');
            document.getElementById('main-header').classList.remove('hidden');

            if(viewName === 'home') document.getElementById('view-home').classList.remove('hidden');
            if(viewName === 'checkout') {
                document.getElementById('view-checkout').classList.remove('hidden');
                renderCheckoutData();
            }
            if(viewName === 'success') {
                document.getElementById('main-header').classList.add('hidden'); // Esconde header no success
                document.getElementById('view-success').classList.remove('hidden');
            }
            window.scrollTo(0, 0);
        }

        function goToCheckout() {
            closeCart();
            changeView('checkout');
        }

        function renderCheckoutData() {
            // Preenche dados do usuario logado
            document.getElementById('checkout-user-data').innerHTML = `
                <p><strong>Nome:</strong> ${auth.user.name}</p>
                <p><strong>E-mail:</strong> ${auth.user.email}</p>
            `;

            // Preenche Resumo
            const container = document.getElementById('checkout-items');
            let total = 0;
            container.innerHTML = cart.map(item => {
                total += item.price * item.quantity;
                return `
                <div class="flex gap-4 items-center">
                     <img src="${item.image}" class="w-16 h-16 rounded object-cover border border-zinc-700" />
                     <div class="flex-1">
                       <p class="text-sm font-bold text-white">${item.name}</p>
                       <p class="text-xs text-amber-500">Qtd: ${item.quantity}</p>
                     </div>
                     <p class="font-bold text-white">${formatCurrency(item.price * item.quantity)}</p>
                </div>
                `;
            }).join('');
            document.getElementById('checkout-total').innerText = formatCurrency(total);
        }

        function finishOrder() {
            cart = []; // Limpa carrinho
            updateCartUI();
            changeView('success');
        }

    </script>
</body>
</html>
