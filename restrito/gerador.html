<script>
        // URL da sua API (Certifique-se de que é a URL da Implantação mais recente)
        const API_URL = "https://script.google.com/macros/s/AKfycbwj7piuiqToBuYjzKob73dEjFeUZ23Ny7zGh_glOxpTdCkHWsvMD9NgWBb296-K-JUZ/exec";
        
        async function carregar() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (!id) {
                alert("ID não encontrado na URL.");
                return;
            }

            try {
                // Usamos text/plain para evitar pré-verificação de CORS do navegador que costuma travar o Apps Script
                const res = await fetch(API_URL, { 
                    method: 'POST', 
                    mode: 'no-cors', // Opcional, mas 'cors' com headers simples é o padrão
                    body: JSON.stringify({ 
                        action: 'buscarLider', 
                        idLider: id, 
                        authToken: 'umadsa2026tokendeseguranca' 
                    }) 
                });

                // Como o Apps Script redireciona, o fetch acima pode não retornar o JSON diretamente se o modo for 'no-cors'.
                // A melhor prática para buscar dados é usar o método abaixo:
                const response = await fetch(API_URL + "?action=buscarLider&idLider=" + id + "&authToken=umadsa2026tokendeseguranca");
                const result = await response.json();

                if (result.status === 'success') {
                    const data = result.data;
                    
                    // Preenchimento dos dados com suporte a quebra de linha no nome
                    document.getElementById('fNome').innerText = data.nome;
                    document.getElementById('fCargo').innerText = data.cargo;
                    
                    // Formata o ID para parecer número de cartão (Grupos de 4)
                    const idLimpo = data.id.replace("LID-", "");
                    document.getElementById('fID').innerText = idLimpo.replace(/(\d{4})/g, '$1 ').trim();
                    
                    document.getElementById('vNasc').innerText = data.nascimento;
                    document.getElementById('vCong').innerText = data.congregacao;
                    
                    // Tratamento da Foto
                    const imgFoto = document.getElementById('fFoto');
                    imgFoto.src = data.urlFoto;
                } else {
                    alert("Líder não encontrado: " + result.message);
                }
            } catch (err) {
                console.error("Erro ao buscar dados:", err);
                alert("Falha ao carregar dados do servidor. Verifique sua conexão.");
            }
        }

        function gerarPDF() {
            const element = document.getElementById('printArea');
            const btn = document.querySelector('button');
            btn.innerText = "GERANDO...";
            
            html2pdf().set({
                margin: 10,
                filename: 'Carteirinha_UMADSA.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 3, useCORS: true, letterRendering: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            }).from(element).save().then(() => {
                btn.innerText = "BAIXAR CARTEIRINHA";
            });
        }
        
        window.onload = carregar;
    </script>
